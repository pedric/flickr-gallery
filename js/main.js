function welcome(){var e={default:"Flickr image explorer",profile:'Welcome back, last time you were browsing for  "'+localStorage.getItem("profile")+'"👇🏼',query:'Welcome back, last time around you searched for "'+localStorage.getItem("last_query")+'"👇🏼'};localStorage.getItem("profile")?document.getElementById("app_title").innerHTML=e.profile:localStorage.getItem("last_query")?document.getElementById("app_title").innerHTML=e.query:document.getElementById("app_title").innerHTML=e.default}function localStorageHandler(e,t,a){localStorage.clear();var l=(new Date).getFullYear()+(new Date).getMonth()+(new Date).getDate();localStorage.setItem("last_api_call",l),localStorage.setItem("flickr_data",e),t?localStorage.setItem("last_query",t):a&&localStorage.setItem("profile",a)}function loaderFeedback(e,t){1===e||2===e||3===e?document.getElementById("loader").style.display="flex":4===e&&200===t&&(document.getElementById("loader").style.display="none")}function buildHtmlList(e,t,a){var l=JSON.parse(localStorage.getItem("flickr_image_array"));a&&(e=0,t=6,document.getElementById("flickr_list").innerHTML=""),t>=l.length&&(t=l.length,document.getElementById("load_more").style.display="none",document.getElementById("no_more_to_load")&&(document.getElementById("no_more_to_load").style.display="block"));for(var o,n,s=e;s<t;s++){l[s].thumbnail&&l[s].title&&(o=document.createElement("li"),n=document.createElement("img"),o.className="image_gallery__list-item",n.setAttribute("src",l[s].thumbnail),n.setAttribute("alt",l[s].title),n.setAttribute("onclick","openSlideshow("+l[s].id+")"),n.setAttribute("data-index",s),o.appendChild(n),document.getElementById("flickr_list").appendChild(o)),document.getElementById("load_more").setAttribute("data-position",s+1)}document.getElementById("result_feedback").style.display="block",document.getElementById("active_images").innerHTML=t,document.getElementById("total_images").innerHTML=l.length}function requestReady(e,t){for(var a,l=JSON.parse(e).photos.photo,o=[],n=0;n<l.length;n++){l[n].farm&&l[n].server&&l[n].id&&l[n].secret&&((a={}).id=n,a.thumbnail="https://farm"+l[n].farm+".staticflickr.com/"+l[n].server+"/"+l[n].id+"_"+l[n].secret+"_n.jpg",a.large="https://farm"+l[n].farm+".staticflickr.com/"+l[n].server+"/"+l[n].id+"_"+l[n].secret+"_c.jpg",a.title=l[n].title,o.push(a))}localStorage.setItem("flickr_image_array",JSON.stringify(o)),buildHtmlList(0,6,t),destroySlideshow(),buildSlideshow(),loaderFeedback(4,200)}function lazyLoad(e){var t=parseInt(e.target.getAttribute("data-position"));buildHtmlList(t,t+6,!1)}function handleError(e){document.getElementById("loader_message").innerHTML="Unknown error, please try to reload the page or come back later.",document.getElementById("loader_message").style.color="red"}function getFlickrData(e,t,a){var l;loaderFeedback(1,!1);t=t||!1,a=a||!1;if(e)l="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=d5a89ca76750d82938ce16db1d2b6b2b&format=json&nojsoncallback=1&content_type=1&privacy_filter=1&text="+e;else if(t){l="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=d5a89ca76750d82938ce16db1d2b6b2b&format=json&nojsoncallback=1&content_type=1&privacy_filter=1&tag_mode=all&tags="+t;for(var o=document.getElementsByClassName("image_gallery__filter_button"),n=0;n<o.length;n++)o[n].classList.remove("active");event.target.classList.add("active")}else l="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=d5a89ca76750d82938ce16db1d2b6b2b&format=json&nojsoncallback=1&content_type=1&privacy_filter=1&tag_mode=all&tags=dogs,dog";var s=new XMLHttpRequest;s.open("GET",l,!0),s.addEventListener("error",handleError),s.send(),s.onreadystatechange=function(){4===this.readyState&&200===this.status&&(localStorageHandler(this.responseText,e,a),requestReady(this.responseText,!0))}}welcome();var today=(new Date).getFullYear()+(new Date).getMonth()+(new Date).getDate(),lastCall=localStorage.getItem("last_api_call"),storedData=localStorage.getItem("flickr_data");function openSlideshow(e){var t=document.getElementsByClassName("slideshow__slide"),a="block",l="block";e<=0&&(a="none"),e>=t.length&&(l="none");for(var o=document.getElementsByClassName("slideshow"),n=0;n<o.length;n++)o[n].style.display="block",o[n].setAttribute("aria-hidden",!1);for(n=0;n<t.length;n++)n===e&&(t[n].classList.add("active"),t[n].setAttribute("aria-hidden",!1),t[n].querySelector(".prev_button").style.display=a,t[n].querySelector(".next_button").style.display=l)}function buildSlideshow(){var e=JSON.parse(localStorage.getItem("flickr_image_array")),t=document.createElement("div");t.className="slideshow",t.setAttribute("aria-hidden",!0);for(var a,l,o,n,s,i,r=0;r<e.length;r++){e[r].thumbnail&&e[r].title&&(a=document.createElement("div"),l=document.createElement("img"),o=document.createElement("img"),n=document.createElement("p"),s=document.createElement("button"),i=document.createElement("button"),a.className="slideshow__slide",a.setAttribute("aria-hidden",!0),a.setAttribute("aria-label",e[r].title),s.className="prev_button",s.appendChild(document.createTextNode("previous")),s.setAttribute("onclick","jump(-1)"),i.className="next_button",i.appendChild(document.createTextNode("next")),i.setAttribute("onclick","jump(1)"),n.appendChild(document.createTextNode(e[r].title)),l.setAttribute("alt","click me to close slideshow"),l.setAttribute("src","images/cross_light.svg"),l.setAttribute("onclick","hideSlideshow()"),l.className="slideshow__close-button",o.className="slideshow__image",o.setAttribute("src",e[r].large),o.setAttribute("alt",e[r].title),o.setAttribute("data-index",r),o.setAttribute("onclick","jump(1)"),a.appendChild(l),a.appendChild(o),a.appendChild(n),a.appendChild(s),a.appendChild(i),t.appendChild(a))}document.querySelector("body").appendChild(t)}function jump(e){for(var t=0,a=document.getElementsByClassName("slideshow__slide"),l=0;l<a.length;l++)a[l].classList.contains("active")&&(a[l].classList.remove("active"),t=l+e);var o="block",n="block";t<=0&&(o="none",t=0),t>a.length-1&&(n="none",t=a.length-1);for(l=0;l<a.length;l++)l===t&&(a[l].classList.add("active"),a[l].setAttribute("aria-hidden",!1),a[l].querySelector(".prev_button").style.display=o,a[l].querySelector(".next_button").style.display=n)}function hideSlideshow(){for(var e=document.getElementsByClassName("slideshow"),t=0;t<e.length;t++)e[t].style.display="none";for(var a=document.getElementsByClassName("slideshow__slide"),t=0;t<a.length;t++)a[t].classList.remove("active")}function destroySlideshow(){var e=document.getElementsByClassName("slideshow");e[0]&&e[0].remove()}!lastCall||lastCall<today?getFlickrData(!1,!1):storedData?requestReady(storedData):(console.log("Something went wrong, app wil try to load data from API"),getFlickrData(!1,!1)),document.getElementById("load_more").addEventListener("click",function(){lazyLoad(event)}),document.getElementById("search_button").addEventListener("click",function(e){e.preventDefault(),getFlickrData(document.getElementById("search").value,!1)}),window.addEventListener("click",function(e){"slideshow"===e.target.className&&hideSlideshow()});for(var menu=document.getElementById("nav-main"),buttons=document.getElementsByClassName("toggle-main-menu"),toggleMenu=function(){menu.classList.contains("active")?(menu.classList.remove("active"),menu.setAttribute("aria-hidden",!0)):(menu.classList.add("active"),menu.setAttribute("aria-hidden",!1))},i=0;i<buttons.length;i++)buttons[i].addEventListener("click",function(){toggleMenu()});